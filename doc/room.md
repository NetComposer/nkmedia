# ROOM Plugin

`media`|`room`|[`create`](#create-a-room)|Starts a new room
`media`|`room`|[`destroy`](#destroy-a-room)|Destroys a room
`media`|`room`|[`list`](#list-rooms)|List known rooms
`media`|`room`|[`info`](#get-info-about-a-room)|Gets information about a room




## Create a room

NkMEDIA allows to create generic media rooms. Installed plugis support one or several room classes. The currently supported room classes and supported backends are:

Class|Plugins
---|---|---
sfu|[nkmedia_janus](janus.md)
mcu|[nkmedia_fs](fs.md)

Room Ids are global for all backends and services.

The required fields are:

Field|Default|Description
---|---|---|---
class|(mandatory)|Room class
room_id|(automatic)|Room Id (will be autogenerated if not included)
backend|(automatic)|Forces a specific plugin for the room
audio_codec|"opus"|See each plugin documentation
video_codec|"vp8"|See each plugin documentation
bitrate|0|See each plugin documentation


**Sample**

 ```js
{
	class: "media",
  	subclass: "room",
  	cmd: "create",
  	data: {
    	class: "sfu",
    	video_codec: "vp9"
  },
  tid: 1
}
```
-->
 ```js
{
	result: "ok",
	data: {
    	room_id: "4611e276-3919-9683-0bae-38c9862f00d9"
    },
    tid: 1
}
```


## Destroy a room

Destroys a started room. Current participant sessions, if any, will be removed.

**Sample**

 ```js
{
	class: "media",
  	subclass: "room",
  	cmd: "destroy",
  	data: {
    	room_id: "4611e276-3919-9683-0bae-38c9862f00d9"
  	},
  	tid: 1
}
```


## List rooms

Gets a list of known rooms, along with its class

**Sample**

 ```js
{
	class: "media",
  	subclass: "room",
  	cmd: "list",
    tid: 1
}
```
-->
 ```js
{
	result: "ok",
	data: [
	    {
	      class: "sfu",
	      room_id: "002f5758-3919-9408-4a02-38c9862f00d9"
	    },
	    {
	      class: "sfu",
	      room_id: "8a87bfc2-3919-9161-b1ab-38c9862f00d9"
	    }
  	],
    tid: 1
}
```


## Get info about a room

Gets information about a started room. For _sfu_ rooms, you will get the list of publishers and listeners.


**Sample**

 ```js
{
	class: "media",
  	subclass: "room",
  	cmd: "info",
  	data: {
  		room_id: "002f5758-3919-9408-4a02-38c9862f00d9"
  	},
    tid: 1
}
```
-->
 ```js
{
	result: "ok",
	data: {
		class: "sfu",
		backend: "nkmedia_janus",
    	listeners: {
      		"0737dc33-391a-2700-1470-38c9862f00d9": {
        		peer: "39ce4076-391a-1260-75db-38c9862f00d9",
        		user: "listener1@domain.com"
      		}
    	},
    	publishers: {
      		"39ce4076-391a-1260-75db-38c9862f00d9": {
        		user: "1009"
      		},
      		"90076c74-391a-153c-f6c7-38c9862f00d9": {
        		user: "1008"
      		}
    	}
    },
    tid: 1
}
```





## Room events

The room subsystem generate the following event types:

Type|Body|Description
---|---|---
started|{class: Class, backend: Backend}|Fired when a new room is created
destroyed|{code: Code, reason: Reason}|A room has been destroyed
started_publisher|{session_id: SessId, user: User}|Fired when a new publisher joins an _sfu_ room
stopped_publisher|{session_id: SessId, user: User}|An existing publisher is leaving an _sfu_ room
started_listener|{session_id: SessId, user: User, peer: Peer}|Fired when a new listener joins an _sfu_ room, connected to a _peer_ publisher.
stopped_listener|{session_id: SessId, user: User}|An existing listener is leaving an _sfu_ room


**Sample**

```js
{
  class: "core",
  cmd: "event",
  data: {
    class: "media",
    subclass: "room",
    type: "started",
    obj_id: "11c92417-6c97-6f35-971b-2954afab410b",
    body: {
      class: "sfu",
      backend: "nkmedia_janus"
    }
  },
  tid: 1
}
```
